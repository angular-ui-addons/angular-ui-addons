/*
 * angular-ui-addons
 * http://angular-ui-addons.github.io

 * Version: 0.1.3 - 2015-01-30
 * License: MIT
 */
angular.module("angular-ui-addons",["angular-ui-addons.typeahead","angular-ui-addons.inclist","angular-ui-addons.validation"]),angular.module("angular-ui-addons.typeahead",["ui.bootstrap"]).directive("typeaheadFocus",function(){return{require:"ngModel",link:function(a,b,c,d){console.log("typeaheadFocus processing"),b.bind("click",function(){console.log("typeaheadFocus triggering");var a=d.$viewValue;" "==d.$viewValue&&d.$setViewValue(null),d.$setViewValue(" "),d.$setViewValue(a||" ")}),a.emptyOrMatch=function(a,b){return" "==b?!0:a.indexOf(b)>-1}}}}),angular.module("angular-ui-addons.inclist",["ui.bootstrap","angular-ui-addons.typeahead"]).directive("inclist",function(){return{restrict:"AE",scope:{items:"=inclistItems"},controller:function(a){a.typeaheadItems=[],this.addItem=function(d,e){if(console.log("addItem selection",d),angular.isDefined(d)&&""!==d&&(!a.isUnique||!b(d,a.items,a.itemsField))&&(!a.isTypeaheadRestrict||b(d,a.typeaheadItems,a.typeaheadLabelField)||a.isTypeaheadRestrictValidExcl&&e)){var f=c(d,a.typeaheadItems,a.itemsField);return void 0===f&&(f={},f.id="id"+Date.now(),f[a.itemsField]=d),a.items.push(f),!0}return!1},this.getItems=function(){return a.items},this.getFlatItem=function(b){if(angular.isObject(b)&&angular.isUndefined(b[a.itemsField])){var c="Inclist list item should be an object with '"+a.itemsField+"' field to extract string value from";throw console.error(c),new Error(c)}return b[a.itemsField]},this.removeItem=function(b){var c=[];angular.forEach(a.items,function(d){d[a.itemsField]!=b&&c.push(d)}),a.items=c},this.setTypeaheadItems=function(b){a.typeaheadItems=b},this.setTypeaheadRestrict=function(b){a.isTypeaheadRestrict=b},this.setTypeaheadRestrictValidExcl=function(b){a.isTypeaheadRestrictValidExcl=b},this.setTypeaheadLabelField=function(b){a.typeaheadLabelField=b};var b=function(a,b,c){var d=!1;return angular.forEach(b,function(e){d||(console.log("searching item ",e," in ",b," by ",c," for ",a),void 0!==c?e[c]==a&&(d=!0):e==a&&(d=!0))}),d},c=function(a,b,c){var d;return angular.forEach(b,function(b){b[c]==a&&(d=b)}),d}},link:function(a,b,c){a.isUnique=angular.isDefined(c.inclistUnique),a.itemsField=c.inclistField}}}).directive("inclistInput",function(){return{require:"^inclist",restrict:"AE",scope:{inclistForm:"=",typeaheadItems:"="},replace:!0,templateUrl:"template/inclist/inclist-input.html",compile:function(a,b){return a.find("input").attr("ng-model","selection"),b.typeaheadLabelField?a.find("input").attr("typeahead","item as item."+b.typeaheadLabelField+" for item in typeaheadItems | filter:$viewValue:emptyOrMatch | limitTo:20"):a.find("input").attr("typeahead","item as item for item in typeaheadItems | filter:$viewValue:emptyOrMatch | limitTo:20"),b.typeaheadTemplate&&a.find("input").attr("typeahead-template-url",b.typeaheadTemplate),a.find("input").attr("typeahead-min-length","0"),a.find("input").attr("typeahead-focus",""),function(a,c,d,e){console.log("inclistInput scope",a),c.find("input").attr("placeholder",d.placeholder),a.typeaheadItems&&a.typeaheadItems instanceof Array&&e.setTypeaheadItems(a.typeaheadItems),e.setTypeaheadLabelField(d.typeaheadLabelField),e.setTypeaheadRestrict(angular.isDefined(d.typeaheadRestrict)),e.setTypeaheadRestrictValidExcl(angular.isDefined(d.typeaheadRestrictValidExcl)),a.addItemFromSelection=function(){console.log("addItemFromSelection scope.selection",a.selection);var c;if(a.selection instanceof Object)c=a.selection[d.typeaheadLabelField];else{if("email"==b.inputType&&!a.selection.match(/^[a-z0-9!#$%&'*+/=?^_`{|}~.-]+@[a-z0-9-]+.[a-z0-9-]/))return 0;c=a.selection}e.addItem(c,a.inclistForm.$valid)&&(a.selection="",a.$apply())},c.on("submit",a.addItemFromSelection)}}}}).directive("inclistOut",function(){return{require:"^inclist",restrict:"AE",scope:{},templateUrl:"template/inclist/inclist-out-list.html",link:function(a,b,c,d){a.items=d.getItems(),a.getFlatItem=function(a){return d.getFlatItem(a)},a.removeItem=function(b){d.removeItem(a.getFlatItem(b)),a.items=d.getItems()}}}}),angular.module("angular-ui-addons.validation",[]).directive("strongPassword",function(){var a=function(a){return a&&a.length>6};return{require:"ngModel",link:function(b,c,d,e){e.$parsers.unshift(function(b){var c=a(b);return e.$setValidity("strongPass",c),b}),e.$formatters.unshift(function(b){var c=a(b);return e.$setValidity("strongPass",c),b})}}});