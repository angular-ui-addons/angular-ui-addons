/*
 * angular-ui-addons
 * http://angular-ui-addons.github.io

 * Version: 0.1.5 - 2015-03-02
 * License: MIT
 */
angular.module("angular-ui-addons",["angular-ui-addons.templates","angular-ui-addons.typeahead","angular-ui-addons.inclist","angular-ui-addons.validation"]),angular.module("angular-ui-addons.templates",["template/inclist/inclist-input.html","template/inclist/inclist-out-list.html"]),angular.module("angular-ui-addons.typeahead",["ui.bootstrap"]).directive("typeaheadFocus",function(){return{require:"ngModel",link:function(a,b,c,d){console.log("typeaheadFocus processing"),b.bind("click",function(){console.log("typeaheadFocus triggering");var a=d.$viewValue;" "==d.$viewValue&&d.$setViewValue(null),d.$setViewValue(" "),d.$setViewValue(a||" ")}),a.emptyOrMatch=function(a,b){return" "==b?!0:void 0!==a&&void 0!==a.indexOf&&a.indexOf(b)>-1}}}}),EMAIL_REGEXP=/^[a-z0-9!#$%&'*+/=?^_`{|}~.-]+@[a-z0-9-]+.[a-z0-9-]/,URL_REGEXP=/(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?/,angular.module("angular-ui-addons.inclist",["ui.bootstrap","angular-ui-addons.typeahead"]).directive("inclist",function(){return{restrict:"AE",scope:{items:"=inclistItems"},controller:function(a){a.typeaheadItems=[],this.addItem=function(d){if(console.log("addItem selection",d),angular.isDefined(d)&&""!==d&&(!a.isUnique||!b(d,a.items,a.itemsField))&&(!a.typeaheadItems||0===a.typeaheadItems.length||!a.isTypeaheadRestrict||b(d,a.typeaheadItems,a.typeaheadLabelField)||a.isTypeaheadRestrictValidExcl&&a.inclistForm.$valid)){var e=c(d,a.typeaheadItems,a.itemsField);return void 0===e&&(e={},e.id="id"+Date.now(),e[a.itemsField]=d),a.items.push(e),a.inclistForm&&(a.inclistForm.$setDirty(),a.checkItemsValidity()),!0}return!1},this.getItems=function(){return a.items},this.getFlatItem=function(b){if(angular.isObject(b)&&angular.isUndefined(b[a.itemsField])){var c="Inclist list item should be an object with '"+a.itemsField+"' field to extract string value from";throw console.error(c),new Error(c)}return b[a.itemsField]},this.removeItem=function(b){var c=[];angular.forEach(a.items,function(d){d[a.itemsField]!=b&&c.push(d)}),a.items=c,a.inclistForm&&(a.inclistForm.$setDirty(),a.checkItemsValidity())},this.setTypeaheadItems=function(b){a.typeaheadItems=b},this.setTypeaheadOnSelect=function(b){a.typeaheadOnSelect=b},this.setTypeaheadRestrict=function(b){a.isTypeaheadRestrict=b},this.setTypeaheadRestrictValidExcl=function(b){a.isTypeaheadRestrictValidExcl=b},this.setTypeaheadLabelField=function(b){a.typeaheadLabelField=b},this.setInclistForm=function(b){a.inclistForm=b},this.setInclistFocused=function(b){a.inclistFocused=b};var b=function(a,b,c){var d=!1;return angular.forEach(b,function(e){d||(console.log("searching item ",e," in ",b," by ",c," for ",a),void 0!==c?e[c]==a&&(d=!0):e==a&&(d=!0))}),d},c=function(a,b,c){var d;return angular.forEach(b,function(b){b[c]==a&&(d=b)}),d};a.checkItemsValidity=function(){a.itemsRequired&&(0===a.items.length?a.inclistForm.$setValidity("required-items",!1):a.inclistForm.$setValidity("required-items",!0))}},link:function(a,b,c){a.isUnique=angular.isDefined(c.inclistUnique),a.itemsField=c.inclistField,a.itemsRequired=angular.isDefined(c.required),a.$watch(function(){return a.inclistForm?a.inclistForm.$valid:void 0},function(){a.inclistForm&&a.inclistForm.$valid?(b.addClass("ng-valid"),b.removeClass("ng-invalid")):(b.addClass("ng-invalid"),b.removeClass("ng-valid"))}),a.$watch(function(){return a.inclistForm?a.inclistForm.$dirty:void 0},function(){a.inclistForm&&a.inclistForm.$dirty&&b.addClass("ng-dirty")}),a.$watch(function(){return a.inclistFocused},function(){a.inclistFocused?b.addClass("focus"):b.removeClass("focus"),a.inclistFocused===!1&&a.inclistForm&&a.inclistForm.$dirty&&b.addClass("ng-blur-after-edit"),a.inclistFocused===!1&&a.checkItemsValidity()}),b.bind("click",function(){b.find("input")[0].focus()})}}}).directive("inclistInput",["$timeout",function(a){return{require:"^inclist",restrict:"AE",scope:{typeaheadItems:"="},replace:!0,templateUrl:"template/inclist/inclist-input.html",controller:["$scope",function(b){b.typeaheadOnSelect=function(c){a(function(){b.addItemFromSelection(c)},0)}}],compile:function(b,c){return console.log("tElement",b),b.find("form").attr("name","inclistForm"),b.find("input").attr("type",c.inputType),b.find("input").attr("name","selection"),b.find("input").attr("ng-model","selection"),angular.isDefined(c.typeaheadItems)&&(c.typeaheadLabelField?b.find("input").attr("typeahead","item as item."+c.typeaheadLabelField+" for item in typeaheadItems | filter:$viewValue:emptyOrMatch | limitTo:20"):b.find("input").attr("typeahead","item as item for item in typeaheadItems | filter:$viewValue:emptyOrMatch | limitTo:20"),c.typeaheadTemplate&&b.find("input").attr("typeahead-template-url",c.typeaheadTemplate),b.find("input").attr("typeahead-min-length","0"),b.find("input").attr("typeahead-focus",""),b.find("input").attr("typeahead-on-select","typeaheadOnSelect($item, $model, $label)")),b.find("input").attr("ng-focus","inputOnFocus()"),b.find("input").attr("ng-blur","inputOnBlur()"),b.find("input").attr("placeholder",c.placeholder),function(b,c,d,e){console.log("inclistInput scope",b),e.setInclistForm(b.inclistForm),b.typeaheadItems&&b.typeaheadItems instanceof Array&&(e.setTypeaheadItems(b.typeaheadItems),e.setTypeaheadLabelField(d.typeaheadLabelField),e.setTypeaheadRestrict(angular.isDefined(d.typeaheadRestrict)),e.setTypeaheadRestrictValidExcl(angular.isDefined(d.typeaheadRestrictValidExcl))),b.addItemFromSelection=function(a){if(!a||a instanceof Event||void 0!==jQuery&&a instanceof jQuery.Event||(b.selection=a),!b.selection||0===b.selection.length||" "===b.selection)return 0;console.log("addItemFromSelection scope.selection",b.selection);var c;c=b.selection instanceof Object&&b.typeaheadItems?b.selection[d.typeaheadLabelField]:b.selection,c&&b.inclistForm.selection.$valid&&e.addItem(c)&&(b.selection="",b.$$phase||b.$apply())},b.inputOnBlur=function(){a(function(){b.addItemFromSelection(),e.setInclistFocused(!1)},0)},b.inputOnFocus=function(){a(function(){b.addItemFromSelection(),e.setInclistFocused(!0)},0)},c.on("submit",b.addItemFromSelection)}}}}]).directive("inclistOut",function(){return{require:"^inclist",restrict:"AE",scope:{},templateUrl:"template/inclist/inclist-out-list.html",link:function(a,b,c,d){a.items=d.getItems(),a.getFlatItem=function(a){return d.getFlatItem(a)},a.removeItem=function(b){d.removeItem(a.getFlatItem(b)),a.items=d.getItems()}}}}),angular.module("angular-ui-addons.validation",[]).directive("strongPassword",function(){var a=function(a){return a&&a.length>6};return{require:"ngModel",link:function(b,c,d,e){e.$parsers.unshift(function(b){var c=a(b);return e.$setValidity("strongPass",c),b}),e.$formatters.unshift(function(b){var c=a(b);return e.$setValidity("strongPass",c),b})}}}),angular.module("template/inclist/inclist-input.html",[]).run(["$templateCache",function(a){a.put("template/inclist/inclist-input.html",'<div>\n  <form>\n    <!--\n      If using custom template you have to use <form> and <input> elements for the same as in current template\n      as of the directive \'inclist-input\' will inject appropriate behavior based on these elements.\n    -->\n    <div class="input-group">\n      <input autocomplete="off" class="form-control"\n             placeholder="Type here and press enter to add property">\n\n      <span class="input-group-btn"><button class="btn btn-default" type="submit">+</button></span>\n    </div>\n  </form>\n</div>\n')}]),angular.module("template/inclist/inclist-out-list.html",[]).run(["$templateCache",function(a){a.put("template/inclist/inclist-out-list.html",'<ul class="list-inline plates">\n  <li ng-repeat="item in items">{{ getFlatItem(item) }}\n    <button type="button" class="close" aria-hidden="true" ng-click="removeItem(item)">&times;</button>\n  </li>\n</ul>')}]);